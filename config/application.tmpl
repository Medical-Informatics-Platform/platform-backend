# Configuration template for the platform running inside a Docker container


### EMBEDDED SERVER CONFIGURATION ###
server:
  servlet:
    contextPath: "/services"
  port: 8080
  forward-headers-strategy: native


### DATABASE CONFIGURATION ###
spring:
  datasource:
    url: {{ default .Env.PLATFORM_DB_URL "jdbc:postgresql://172.17.0.1:5433/portal" }}
    username: {{ default .Env.PLATFORM_DB_USER "portal" }}
    password: {{ default .Env.PLATFORM_DB_PASSWORD "portalpwd" }}
    driver-class-name: org.postgresql.Driver
  data:
    jpa:
      repositories:
        bootstrap-mode: default
  jpa:
    hibernate:
      ddl-auto: validate
  mvc:
    pathmatch:
      matching-strategy: ant_path_matcher
  jackson:
    default-property-inclusion: non_null
  security:
    oauth2:
      client:
        registration:
          keycloak:
            authorization-grant-type: authorization_code
            client-id: {{ .Env.KEYCLOAK_CLIENT_ID }}
            client-secret: {{ .Env.KEYCLOAK_CLIENT_SECRET }}
            provider: keycloak
            scope: openid
        provider:
          keycloak:
            issuer-uri: {{ .Env.KEYCLOAK_AUTH_URL }}realms/{{ .Env.KEYCLOAK_REALM }}
            user-name-attribute: preferred_username
      # Allow API clients (e.g. notebooks) to authenticate with Bearer JWTs.
      resourceserver:
        jwt:
          issuer-uri: {{ .Env.KEYCLOAK_AUTH_URL }}realms/{{ .Env.KEYCLOAK_REALM }}


### AUTHENTICATION ###
authentication:
  enabled: {{ default .Env.AUTHENTICATION "1" }}
  all_datasets_allowed_claim: research_dataset_all
  all_experiments_allowed_claim: research_experiment_all
  dataset_claim_prefix: research_dataset_


### EXTERNAL SERVICES ###
services:
  algorithmsUpdateInterval: {{  .Env.ALGORITHM_UPDATE_INTERVAL}}
  exaflow:
    algorithmsUrl: {{ .Env.EXAFLOW_URL}}/algorithms
    attributesUrl: {{ .Env.EXAFLOW_URL}}/data_models_attributes
    cdesMetadataUrl: {{ .Env.EXAFLOW_URL}}/cdes_metadata
    datasets_variables: {{ .Env.EXAFLOW_URL}}/datasets_variables


### EXTERNAL FILES ###
# Files are imported when building the docker image
files:
  disabledAlgorithms_json: "file:{{ .Env.DISABLED_ALGORITHMS_CONFIG_PATH}}"


frontend:
  base-url: {{ .Env.FRONTEND_BASE_URL }}
